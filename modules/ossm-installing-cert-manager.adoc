// Module included in the following assemblies:
//
// * service-mesh-docs-main/install/ossm-installing-openshift-service-mesh.adoc

:_mod-docs-content-type: PROCEDURE
[id="ossm-installing-cert-manager_{context}"]
= Installing cert-manager
//TP1 content influx. Title, etc may change.
//Content is very similar to 2.x content
//all kinds of formatting things to fix. want to see if a build will generate to have a look, and see how it fits structurally with the IA.

You can integrate cert-manager with {SMProduct} by deploying `istio-csr` and then creating an `Istio` resource that uses the `istio-csr` agent to process workload and control plane certificate signing requests. This example creates a self-signed `Issuer`, but any other `Issuer` can be used instead.

[IMPORTANT]
====
You must install cert-manager before installing your `Istio` resource.
====

.Procedure

. Create the `istio-system` namespace by running the following command:
+
[source, terminal]
----
$ oc create namespace istio-system
----

. Create the root issuer by creating an `Issuer` object in a YAML file.
+
.. Create an `Issuer` object similar to the following example:
+
.Example `issuer.yaml` file
[source, yaml]
----
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  name: selfsigned
  namespace: istio-system
spec:
  selfSigned: {}
---
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
    name: istio-ca
    namespace: istio-system
spec:
  isCA: true
  duration: 87600h # 10 years
  secretName: istio-ca
  commonName: istio-ca
  privateKey:
    algorithm: ECDSA
    size: 256
  subject:
    organizations:
      - cluster.local
      - cert-manager
  issuerRef:
    name: selfsigned
    kind: Issuer
    group: cert-manager.io
---
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  name: istio-ca
  namespace: istio-system
spec:
  ca:
    secretName: istio-ca
---
----
+
.. Create the objects by running the following command:
+
[source, terminal]
+
----
$ oc apply -f issuer.yaml
----
+
.. Wait for the `istio-ca` certificate to contain the "Ready" status condition by running the following command:
+
[source, terminal]
----
$ oc wait --for=condition=Ready certificates/istio-ca -n istio-system
----

. Copy the `istio-ca` certificate to the `cert-manager` namespace so it can be used by istio-csr:
+
.. Copy the secret to a local file by running the following command:
+
[source, terminal]
----
$ oc get -n istio-system secret istio-ca -o jsonpath='{.data.tls\.crt}' | base64 -d > ca.pem
----
+
.. Create a secret from the local certificate file in the `cert-manager` namespace by running the following command:
+
[source, terminal]
----
$ oc create secret generic -n cert-manager istio-root-ca --from-file=ca.pem=ca.pem
----